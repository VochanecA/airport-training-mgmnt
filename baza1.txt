-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.course_attendees (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  course_id uuid,
  staff_id uuid,
  enrollment_date timestamp with time zone DEFAULT now(),
  attendance_status character varying DEFAULT 'enrolled'::character varying,
  completion_status character varying,
  grade character varying,
  certificate_issued boolean DEFAULT false,
  certificate_number character varying,
  certificate_issue_date date,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT course_attendees_pkey PRIMARY KEY (id),
  CONSTRAINT course_attendees_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id),
  CONSTRAINT course_attendees_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id)
);
CREATE TABLE public.course_instructors (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  course_id uuid,
  instructor_id uuid,
  role character varying DEFAULT 'primary'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT course_instructors_pkey PRIMARY KEY (id),
  CONSTRAINT course_instructors_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id),
  CONSTRAINT course_instructors_instructor_id_fkey FOREIGN KEY (instructor_id) REFERENCES public.instructors(id)
);
CREATE TABLE public.courses (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  course_code character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  description text,
  course_type character varying NOT NULL,
  training_master_id uuid,
  start_date date NOT NULL,
  end_date date NOT NULL,
  location character varying,
  max_attendees integer,
  cost numeric,
  currency character varying DEFAULT 'EUR'::character varying,
  status character varying DEFAULT 'planned'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT courses_pkey PRIMARY KEY (id),
  CONSTRAINT courses_training_master_id_fkey FOREIGN KEY (training_master_id) REFERENCES public.training_certificates_master(id)
);
CREATE TABLE public.instructors (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  staff_id uuid,
  instructor_code character varying UNIQUE,
  specializations ARRAY,
  certification_number character varying,
  certification_expiry date,
  status character varying DEFAULT 'active'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT instructors_pkey PRIMARY KEY (id),
  CONSTRAINT instructors_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id)
);
CREATE TABLE public.position_required_training (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  position_id uuid,
  training_master_id uuid,
  is_mandatory boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT position_required_training_pkey PRIMARY KEY (id),
  CONSTRAINT position_required_training_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.working_positions(id),
  CONSTRAINT position_required_training_training_master_id_fkey FOREIGN KEY (training_master_id) REFERENCES public.training_certificates_master(id)
);
CREATE TABLE public.staff (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  employee_number character varying NOT NULL UNIQUE,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  email character varying UNIQUE,
  phone character varying,
  position_id uuid,
  staff_type character varying DEFAULT 'employee'::character varying,
  status character varying DEFAULT 'active'::character varying,
  hire_date date,
  termination_date date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT staff_pkey PRIMARY KEY (id),
  CONSTRAINT staff_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.working_positions(id)
);
CREATE TABLE public.training_alerts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  staff_id uuid,
  training_master_id uuid,
  alert_type character varying NOT NULL,
  alert_date date NOT NULL,
  expiry_date date,
  days_until_expiry integer,
  is_acknowledged boolean DEFAULT false,
  acknowledged_at timestamp with time zone,
  acknowledged_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT training_alerts_pkey PRIMARY KEY (id),
  CONSTRAINT training_alerts_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id),
  CONSTRAINT training_alerts_training_master_id_fkey FOREIGN KEY (training_master_id) REFERENCES public.training_certificates_master(id),
  CONSTRAINT training_alerts_acknowledged_by_fkey FOREIGN KEY (acknowledged_by) REFERENCES public.staff(id)
);
CREATE TABLE public.training_certificate_records (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  staff_id uuid,
  training_master_id uuid,
  certificate_number character varying,
  issue_date date NOT NULL,
  expiry_date date,
  completion_date date,
  grade character varying,
  notes text,
  training_provider character varying,
  instructor_name character varying,
  status character varying DEFAULT 'valid'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT training_certificate_records_pkey PRIMARY KEY (id),
  CONSTRAINT training_certificate_records_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staff(id),
  CONSTRAINT training_certificate_records_training_master_id_fkey FOREIGN KEY (training_master_id) REFERENCES public.training_certificates_master(id)
);
CREATE TABLE public.training_certificate_types (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  category character varying,
  validity_period_months integer,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT training_certificate_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.training_certificates_master (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  type_id uuid,
  code character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  description text,
  training_provider character varying,
  duration_hours numeric,
  validity_months integer,
  renewal_before_days integer DEFAULT 30,
  is_mandatory boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT training_certificates_master_pkey PRIMARY KEY (id),
  CONSTRAINT training_certificates_master_type_id_fkey FOREIGN KEY (type_id) REFERENCES public.training_certificate_types(id)
);
CREATE TABLE public.training_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  training_type character varying CHECK (training_type::text = ANY (ARRAY['initial'::character varying, 'recurrent'::character varying, 're_qualification'::character varying, 'update'::character varying, 'ojt'::character varying, 'refresher'::character varying, 'conversion'::character varying]::text[])),
  category character varying CHECK (category::text = ANY (ARRAY['safety'::character varying, 'technical'::character varying, 'operational'::character varying, 'administrative'::character varying, 'customer_service'::character varying, 'management'::character varying]::text[])),
  hours_initial_theory numeric,
  hours_initial_practical numeric,
  hours_initial_ojt numeric,
  hours_initial_total numeric,
  hours_recurrent_theory numeric,
  hours_recurrent_practical numeric,
  hours_recurrent_ojt numeric,
  hours_recurrent_total numeric,
  hours_re_qualification_theory numeric,
  hours_re_qualification_practical numeric,
  hours_re_qualification_ojt numeric,
  hours_re_qualification_total numeric,
  hours_update_theory numeric,
  hours_update_practical numeric,
  hours_update_ojt numeric,
  hours_update_total numeric,
  hours_ojt_theory numeric,
  hours_ojt_practical numeric,
  hours_ojt_total numeric,
  validity_period_months numeric,
  renewal_notice_days integer,
  is_mandatory boolean DEFAULT true,
  difficulty_level character varying CHECK (difficulty_level::text = ANY (ARRAY['basic'::character varying, 'intermediate'::character varying, 'advanced'::character varying, 'expert'::character varying]::text[])),
  reference_standard character varying,
  passing_score integer CHECK (passing_score >= 0 AND passing_score <= 100),
  requires_practical boolean DEFAULT false,
  requires_written_exam boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT training_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.trainings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  training_type_id uuid,
  title character varying NOT NULL,
  description text,
  instructor character varying,
  location character varying,
  start_date timestamp with time zone NOT NULL,
  end_date timestamp with time zone NOT NULL,
  capacity integer,
  status character varying DEFAULT 'scheduled'::character varying,
  training_hours_theory numeric,
  training_hours_practical numeric,
  training_hours_ojt numeric,
  training_hours_total numeric,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT trainings_pkey PRIMARY KEY (id),
  CONSTRAINT trainings_training_type_id_fkey FOREIGN KEY (training_type_id) REFERENCES public.training_types(id)
);
CREATE TABLE public.working_positions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  code character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  department character varying,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT working_positions_pkey PRIMARY KEY (id)
);